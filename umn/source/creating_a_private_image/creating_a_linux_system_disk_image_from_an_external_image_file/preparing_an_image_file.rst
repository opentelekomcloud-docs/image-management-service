:original_name: en-us_topic_0030713198.html

.. _en-us_topic_0030713198:

Preparing an Image File
=======================

You need to prepare an image file that meets the platform requirements.

.. note::

   -  You are advised to complete the file system, network, and driver configurations in :ref:`Table 1 <en-us_topic_0030713198__table85212269215>` on the source VM and then export the image file. You can also complete the configurations on the created ECSs. For details, see :ref:`What Do I Do If a Linux Image File Is Not Pre-Configured When I Use It to Register a Private Image? <en-us_topic_0030713211>`
   -  Currently, a large image file (maximum: 1 TB) can be imported only in RAW or ZVHD2 format. In addition to the requirements described in :ref:`Table 1 <en-us_topic_0030713198__table85212269215>`, a bitmap file needs to be generated for each RAW image file. The bitmap file is uploaded together with the image file. For details, see :ref:`Quickly Importing an Image File <en-us_topic_0030713151>`.

.. _en-us_topic_0030713198__table85212269215:

.. table:: **Table 1** Linux image file requirements

   +-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Image File Property               | Requirement                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
   +===================================+======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================+
   | OS                                | -  SUSE, Oracle Linux, Red Hat, Ubuntu, openSUSE, CentOS, Debian, Fedora, EulerOS, and NeoKylin                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
   |                                   | -  32-bit or 64-bit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
   |                                   | -  The OS cannot be bound to specific hardware.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
   |                                   | -  The OS must support full virtualization.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
   |                                   | For details about the supported OS versions, see :ref:`External Image File Formats and Supported OSs <en-us_topic_0030713143>`. These OSs support automatic configuration. For details, see :ref:`What Will the System Do to an Image File When I Use the File to Register a Private Image? <en-us_topic_0032307025>` For other OSs, check and install VirtIO drivers (see :ref:`Installing Native KVM Drivers <en-us_topic_0000001120952155>`). On the image registration page, select **Other Linux**. After the image is imported, whether the system is started depends on the driver integrity. |
   +-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Image format                      | VMDK, VHD, QCOW2, RAW, VHDX, QED, VDI, QCOW, ZVHD2, and ZVHD                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
   +-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Image size                        | Maximum file size: 128 GB                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
   |                                   | If the image size is between 128 GB and 1 TB, convert the image file into the RAW or ZVHD2 format and import the image using fast import.                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
   |                                   | -  For details about how to convert the image file format, see :ref:`Converting the Image Format Using qemu-img-hw <en-us_topic_0171668652>`.                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
   |                                   | -  For details about fast import, see :ref:`fast image file import <en-us_topic_0133773658>`.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
   +-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Network                           | The NIC must be set to DHCP and files must be deleted from the network role directory. Otherwise, the ECS startup or network capability will be abnormal. For details, see:                                                                                                                                                                                                                                                                                                                                                                                                                          |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
   |                                   | -  :ref:`Deleting files from the network rule directory <en-us_topic_0069904570>`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
   |                                   | -  :ref:`Setting the NIC to DHCP <en-us_topic_0030713176>`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
   |                                   | The following value-added operations are optional:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
   |                                   | -  Enabling NIC multi-queue                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
   |                                   |    NIC multi-queue enables multiple vCPUs to process NIC interruptions, thereby improving network PPS and I/O performance. For details, see :ref:`How Do I Enable NIC Multi-Queue for an Image? <en-us_topic_0085214115>`                                                                                                                                                                                                                                                                                                                                                                            |
   +-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Tool                              | You are advised to install Cloud-Init.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
   |                                   | Cloud-Init is an open-source tool for cloud instance initialization. When creating ECSs from an image with Cloud-Init, you can use user data injection to inject customized initialization details (for example, an ECS login password) to the ECSs. You can also configure and manage a running ECS by querying and using metadata. If Cloud-Init is not installed, you cannot apply custom configurations to the ECSs. You will have to use the original password in the image file to log in to the ECSs.                                                                                         |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
   |                                   | For details, see :ref:`Installing Cloud-Init <en-us_topic_0030730603>`.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
   +-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Driver                            | :ref:`Installing native KVM drivers <en-us_topic_0000001120952155>`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
   +-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | File system                       | -  :ref:`Changing the disk identifier in the GRUB configuration file to UUID <en-us_topic_0086020895>`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
   |                                   | -  :ref:`Changing the disk identifier in the fstab file to UUID <en-us_topic_0086024961>`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
   +-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Other requirements                | -  Currently, images with data disks cannot be created. The image file must contain only the system disk, and the system disk capacity must be between 1 GB and 1 TB.                                                                                                                                                                                                                                                                                                                                                                                                                                |
   |                                   | -  The initial password in the image file must contain uppercase letters, lowercase letters, digits, and special characters (``!@$%^-_=+[{}]:,./?``).                                                                                                                                                                                                                                                                                                                                                                                                                                                |
   |                                   | -  The boot partition and system partition must be on the same disk.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
   |                                   | -  Generally, the boot mode is BIOS in an image. Some OS images support the UEFI boot mode. For details, see "OSs Supporting UEFI Boot Mode" in *Image Service Management User Guide*.                                                                                                                                                                                                                                                                                                                                                                                                               |
   |                                   | -  The image file cannot be encrypted, or ECSs created from the registered image may not work properly.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
   |                                   | -  The **/etc/fstab** file cannot contain automatic mounting information of non-system disks. Otherwise, the login to the created ECS may fail.                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
   |                                   | -  If the external image file uses LVM as the system disk, ECSs created from the private image do not support file injection.                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
   |                                   | -  If the VM where the external image file is located has been shut down, it must be a graceful shutdown. Otherwise, a blue screen may occur when the ECS created from the private image is started.                                                                                                                                                                                                                                                                                                                                                                                                 |
   +-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
