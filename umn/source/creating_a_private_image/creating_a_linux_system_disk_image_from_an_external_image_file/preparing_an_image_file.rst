:original_name: en-us_topic_0030713198.html

.. _en-us_topic_0030713198:

Preparing an Image File
=======================

You need to prepare an image file that can be used to create a private image.

.. note::

   Currently, a large image file (maximum: 1 TB) can be imported only in RAW or ZVHD2 format. In addition to the requirements described in :ref:`Table 2 <en-us_topic_0030713198__table85212269215>`, a bitmap file needs to be generated alongside each RAW image file. The bitmap file is uploaded together with the image file. For details, see :ref:`Fast Import of an Image File <en-us_topic_0030713151>`.

Initial Configuration for an Image File
---------------------------------------

The initial configuration must be completed on the source VM before an image file is exported from it. If you did not configure it, use the image file to create an ECS, configure the ECS, and use the ECS to create a private image. For details, see :ref:`What Do I Do If a Linux Image File Is Not Pre-Configured When I Use It to Register a Private Image? <en-us_topic_0030713211>`

.. _en-us_topic_0030713198__table184016916467:

.. table:: **Table 1** Initial configuration for an image file

   +-----------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Configuration Item                | How to Configure                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
   +===================================+=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================+
   | Network                           | DHCP must be configured. Otherwise, the ECS startup or network capability will be abnormal. For details, see:                                                                                                                                                                                                                                                                                                                                                                                                   |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
   |                                   | -  :ref:`Deleting files from the network rule directory <en-us_topic_0069904570>`                                                                                                                                                                                                                                                                                                                                                                                                                               |
   |                                   | -  :ref:`Configuring DHCP <en-us_topic_0030713176>`                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
   |                                   | The following value-added operations are optional:                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
   |                                   | -  Enabling NIC multi-queue                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
   |                                   |    NIC multi-queue enables multiple vCPUs to process NIC interrupts, thereby improving network PPS and I/O performance. For details, see :ref:`How Do I Enable NIC Multi-Queue for an Image? <en-us_topic_0085214115>`                                                                                                                                                                                                                                                                                          |
   +-----------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Tools                             | You are advised to install Cloud-Init.                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
   |                                   | Cloud-Init is an open-source tool for cloud instance initialization. When creating ECSs from an image with Cloud-Init, you can use user data injection to customize initialization details (for example, an ECS login password) to the ECSs. You can also configure and manage a running ECS by querying and using metadata. If Cloud-Init is not installed, you cannot apply these custom configurations to your ECSs, and you will have to use the original password in the image file to log in to the ECSs. |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
   |                                   | For details, see :ref:`Installing Cloud-Init <en-us_topic_0030730603>`.                                                                                                                                                                                                                                                                                                                                                                                                                                         |
   +-----------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Drivers                           | :ref:`Installing native KVM drivers <en-us_topic_0000001120952155>`                                                                                                                                                                                                                                                                                                                                                                                                                                             |
   +-----------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | File system                       | -  :ref:`Changing disk identifiers in the GRUB file to UUID <en-us_topic_0086020895>`                                                                                                                                                                                                                                                                                                                                                                                                                           |
   |                                   | -  :ref:`Changing disk identifiers in the fstab file to UUID <en-us_topic_0086024961>`                                                                                                                                                                                                                                                                                                                                                                                                                          |
   +-----------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Data disks                        | If multiple data disks are attached to the ECS used to create a private image, ECSs created from the image may be unavailable. Therefore, you need to detach all data disks from the ECS before using it to create a private image.                                                                                                                                                                                                                                                                             |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
   |                                   | For details, see :ref:`Detaching Data Disks from an ECS <en-us_topic_0030713179>`.                                                                                                                                                                                                                                                                                                                                                                                                                              |
   +-----------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Logs                              | If you want to use the ECS console logging function, you need to configure related parameters on the ECS.                                                                                                                                                                                                                                                                                                                                                                                                       |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
   |                                   | For details, see :ref:`Configuring Console Logging <en-us_topic_0057450886>`.                                                                                                                                                                                                                                                                                                                                                                                                                                   |
   +-----------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

Image File Properties
---------------------

.. _en-us_topic_0030713198__table85212269215:

.. table:: **Table 2** Linux image file properties

   +-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Image File Property               | Requirement                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
   +===================================+======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================+
   | OS                                | -  SUSE, Oracle Linux, Red Hat, Ubuntu, openSUSE, CentOS, Debian, Fedora, EulerOS, and NeoKylin                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
   |                                   | -  32-bit or 64-bit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
   |                                   | -  The OS cannot be bound to specific hardware.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
   |                                   | -  The OS must support full virtualization.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
   |                                   | For details about the supported OS versions, see :ref:`External Image File Formats and Supported OSs <en-us_topic_0030713143>`. These OSs support automatic configuration. For details, see :ref:`What Will the System Do to an Image File When I Use the File to Register a Private Image? <en-us_topic_0032307025>` For other OSs, check and install VirtIO drivers (see :ref:`Installing Native KVM Drivers <en-us_topic_0000001120952155>`). On the image registration page, select **Other Linux**. After the image is imported, whether the system is started depends on the driver integrity. |
   +-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Image format                      | VMDK, VHD, QCOW2, RAW, VHDX, QED, VDI, QCOW, ZVHD2, and ZVHD                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
   +-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Image size                        | Maximum file size: 128 GB                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
   |                                   | If the image size is between 128 GB and 1 TB, convert the image file into RAW or ZVHD2 and import it using fast import.                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
   |                                   | -  For details about how to convert the image file format, see :ref:`Converting the Image Format Using qemu-img-hw <en-us_topic_0171668652>`.                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
   |                                   | -  For details about fast import, see :ref:`Fast Import of an Image File <en-us_topic_0133773658>`.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
   +-----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

Other
-----

-  Currently, images with data disks cannot be created. The image file must contain only a system disk, and the system disk size must be between 1 GB and 1 TB.
-  The initial password in the image file must contain uppercase letters, lowercase letters, digits, and special characters (``!@$%^-_=+[{}]:,./?``).
-  The boot partition and system partition must be on the same disk.
-  Generally, the boot mode is BIOS in an image. Some OS images support the UEFI boot mode. For details, see "OSs Supporting UEFI Boot Mode" in *Image Service Management User Guide*.
-  The image file cannot be encrypted, or ECSs created from the registered image may not work properly.
-  The **/etc/fstab** file cannot contain automatic mounting information of non-system disks. Otherwise, the login to the created ECS may fail.
-  If the external image file uses LVM as the system disk, ECSs created from the private image do not support file injection.
-  If the VM where the external image file is located has been shut down, it must be a graceful shutdown. Otherwise, a blue screen may occur when the ECS created from the private image is started.
