:original_name: en-us_topic_0030713189.html

.. _en-us_topic_0030713189:

Preparing an Image File
=======================

You need to prepare an image file that can be used to create a private image.

.. note::

   Currently, a large image file (maximum: 1 TB) can be imported only in RAW or ZVHD2 format. In addition to the requirements described in :ref:`Table 2 <en-us_topic_0030713189__table85212269215>`, a bitmap file needs to be generated alongside each RAW image file. The bitmap file is uploaded together with the image file. For details, see :ref:`Fast Import of an Image File <en-us_topic_0030713151>`.

Initial Configuration for an Image File
---------------------------------------

The initial configuration must be completed on the source VM before an image file is exported from it. If you did not configure it, use the image file to create an ECS, configure the ECS, and use the ECS to create a private image. For details, see :ref:`What Do I Do If a Windows Image File Is Not Pre-Configured When I Use It to Register a Private Image? <en-us_topic_0030713185>`

.. _en-us_topic_0030713189__table186581721175511:

.. table:: **Table 1** Initial configuration for an image file

   +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Configuration Item                | How to Configure                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
   +===================================+==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================+
   | Network                           | DHCP must be configured. Otherwise, the ECS startup or network capability will be abnormal. For details, see:                                                                                                                                                                                                                                                                                                                                                                                                            |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
   |                                   | :ref:`Configuring DHCP <en-us_topic_0030713152>`                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
   |                                   | The following operations are optional:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
   |                                   | -  Enabling NIC multi-queue                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
   |                                   |    NIC multi-queue enables multiple vCPUs to process NIC interrupts, thereby improving network PPS and I/O performance. For details, see :ref:`How Do I Enable NIC Multi-Queue for an Image? <en-us_topic_0085214115>`                                                                                                                                                                                                                                                                                                   |
   +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Tools                             | You are advised to install Cloudbase-Init.                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
   |                                   | Cloudbase-Init is an open-source tool for cloud instance initialization. When creating ECSs from an image with Cloudbase-Init, you can use user data injection to inject customized initialization details (for example, an ECS login password) to the ECSs. You can also configure and manage a running ECS by querying and using metadata. If Cloudbase-Init is not installed, you cannot apply custom configurations to the ECSs. You will have to use the original password in the image file to log in to the ECSs. |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
   |                                   | For details, see :ref:`Installing and Configuring Cloudbase-Init <en-us_topic_0030730602>`.                                                                                                                                                                                                                                                                                                                                                                                                                              |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
   |                                   | If each of your ECSs requires a unique SID in a domain, run Sysprep after Cloudbase-Init is installed. For details, see :ref:`Running Sysprep <en-us_topic_0093887081>`.                                                                                                                                                                                                                                                                                                                                                 |
   +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Drivers                           | An ECS can run properly only after KVM Guest OS drivers (VirtIO drivers) are installed on it. To ensure that ECSs support KVM and to improve network performance, VirtIO drivers must be installed for the image.                                                                                                                                                                                                                                                                                                        |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
   |                                   | :ref:`Installing VirtIO drivers <en-us_topic_0000001841305273>`                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
   |                                   | For GPU-accelerated ECSs, you need to install special drivers when creating a private image. For details, see :ref:`Installing Special Windows Drivers <en-us_topic_0081795392>`.                                                                                                                                                                                                                                                                                                                                        |
   +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

Image File Properties
---------------------

.. _en-us_topic_0030713189__table85212269215:

.. table:: **Table 2** Windows image file properties

   +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Image File Property               | Requirement                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
   +===================================+================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================+
   | OS                                | -  Windows Server 2008, Windows Server 2012, Windows Server 2016                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
   |                                   | -  32-bit or 64-bit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
   |                                   | -  The OS cannot be bound to specific hardware.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
   |                                   | -  The OS must support full virtualization.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
   |                                   | For details about the supported OS versions, see :ref:`External Image File Formats and Supported OSs <en-us_topic_0030713143>`. These OSs support automatic configuration. For details, see :ref:`What Will the System Do to an Image File When I Use the File to Register a Private Image? <en-us_topic_0032307025>` For other OSs, check and install Guest OS drivers. On the image registration page, select **Other Windows**. After the image is imported, whether the system is started depends on the driver integrity. |
   +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Image format                      | VMDK, VHD, QCOW2, RAW, VHDX, QED, VDI, QCOW, ZVHD2, and ZVHD                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
   +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Image size                        | If an image is no larger than 128 GB, import it directly.                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
   |                                   | If an image is between 128 GB and 1 TB, convert the image file into RAW or ZVHD2 and import it using fast import.                                                                                                                                                                                                                                                                                                                                                                                                              |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
   |                                   | -  For details about how to convert the image file format, see :ref:`Converting the Image Format Using qemu-img-hw <en-us_topic_0171668652>`.                                                                                                                                                                                                                                                                                                                                                                                  |
   |                                   | -  For details about fast import, see :ref:`Fast Import of an Image File <en-us_topic_0133773658>`.                                                                                                                                                                                                                                                                                                                                                                                                                            |
   +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

Other
-----

-  Currently, images with data disks cannot be created. The image file must contain only a system disk, and the system disk size must be between 1 GB and 1 TB.
-  The initial password in the image file must contain uppercase letters, lowercase letters, digits, and special characters (``!@$%^-_=+[{}]:,./?``).
-  The boot partition and system partition must be on the same disk.
-  For an external image file, you need a tenant administrator account and password combination.
-  Generally, the boot mode is BIOS in an image. Some OS images support the UEFI boot mode. For details, see :ref:`OSs Supporting UEFI Boot Mode <en-us_topic_0170853315>`.
-  The image file cannot be encrypted, or ECSs created from the registered image may not work properly.
